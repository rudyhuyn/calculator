<UserControl x:Class="CalculatorApp.GraphingCalculator"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="using:CalculatorApp.Controls"
             xmlns:converters="using:CalculatorApp.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:graphControl="using:GraphControl"
             xmlns:local="using:CalculatorApp"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:CalculatorApp.ViewModel"
             DataContextChanged="GraphingCalculator_DataContextChanged"
             mc:Ignorable="d">

    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Name="BooleanToVisibilityConverter"/>
        <converters:BooleanToVisibilityNegationConverter x:Name="BooleanToVisibilityNegationConverter"/>
    </UserControl.Resources>

    <Grid x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition x:Name="RowHamburger" Height="{StaticResource HamburgerHeightGridLength}"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>

        <!-- Left portion of the screen -->
        <Grid x:Name="LeftGrid"
              Grid.Row="1"
              Grid.Column="0">

            <graphControl:Grapher Name="GraphingControl" Grid.Row="0"
                                  Margin="4,7,4,4"
                                  EquationsSource="{x:Bind ViewModel.Equations, Mode=OneWay}"
                                  ForceProportionalAxes="True"
                                  UseSystemFocusVisuals="True"
                                  VariablesUpdated="GraphVariablesUpdated">
                <graphControl:Grapher.Background>
                    <SolidColorBrush Color="White"/>
                </graphControl:Grapher.Background>
                <graphControl:Grapher.EquationTemplate>
                    <DataTemplate x:DataType="vm:EquationViewModel">
                        <graphControl:Equation Expression="{x:Bind Expression, Mode=OneWay}" LineColor="{x:Bind LineColor, Mode=OneWay}"/>
                    </DataTemplate>
                </graphControl:Grapher.EquationTemplate>
            </graphControl:Grapher>

            <!-- Temporary button until the final UI is created -->
            <Button Margin="12,0,0,12"
                    VerticalAlignment="Bottom"
                    FontFamily="{StaticResource SymbolThemeFontFamily}"
                    FontSize="18"
                    Content="&#xE70F;"
                    RequestedTheme="Light">
                <Button.Flyout>
                    <Flyout Placement="TopEdgeAlignedRight">
                        <Flyout.FlyoutPresenterStyle>
                            <Style TargetType="FlyoutPresenter">
                                <Setter Property="RequestedTheme" Value="Default"/>
                                <Setter Property="ScrollViewer.HorizontalScrollMode" Value="Disabled"/>
                                <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
                                <Setter Property="Margin" Value="12,0,0,0"/>
                            </Style>
                        </Flyout.FlyoutPresenterStyle>
                        <ListView x:Name="VariableListView"
                                  MinWidth="300"
                                  ItemsSource="{x:Bind ViewModel.Variables}"
                                  SelectionMode="None">
                            <ListView.Resources>
                                <ResourceDictionary>
                                    <ResourceDictionary.ThemeDictionaries>
                                        <ResourceDictionary x:Key="Default">
                                            <SolidColorBrush x:Key="TextControlBackgroundFocused" Color="Transparent"/>
                                            <SolidColorBrush x:Key="TextControlBackgroundPointerOver" Color="Transparent"/>
                                            <SolidColorBrush x:Key="TextControlForegroundFocused" Color="White"/>
                                            <x:Double x:Key="TextControlThemeMinWidth">32</x:Double>
                                            <x:Double x:Key="TextControlThemeMinHeight">16</x:Double>
                                        </ResourceDictionary>
                                        <ResourceDictionary x:Key="Light">
                                            <SolidColorBrush x:Key="TextControlBackgroundFocused" Color="Transparent"/>
                                            <SolidColorBrush x:Key="TextControlBackgroundPointerOver" Color="Transparent"/>
                                            <SolidColorBrush x:Key="TextControlForegroundFocused" Color="Black"/>
                                            <x:Double x:Key="TextControlThemeMinWidth">32</x:Double>
                                            <x:Double x:Key="TextControlThemeMinHeight">16</x:Double>
                                        </ResourceDictionary>
                                        <ResourceDictionary x:Key="HighContrast">
                                            <SolidColorBrush x:Key="TextControlBackgroundFocused" Color="{ThemeResource SystemColorButtonFaceColor}"/>
                                            <SolidColorBrush x:Key="TextControlBackgroundPointerOver" Color="{StaticResource SystemColorButtonFaceColor}"/>
                                            <SolidColorBrush x:Key="TextControlForegroundFocused" Color="{ThemeResource SystemColorButtonTextColor}"/>
                                            <x:Double x:Key="TextControlThemeMinWidth">32</x:Double>
                                            <x:Double x:Key="TextControlThemeMinHeight">16</x:Double>
                                        </ResourceDictionary>
                                    </ResourceDictionary.ThemeDictionaries>
                                </ResourceDictionary>
                            </ListView.Resources>
                            <ListView.Header>
                                <TextBlock x:Uid="VaiablesHeader" Margin="0,0,0,12"/>
                            </ListView.Header>
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="IsTabStop" Value="False"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Margin" Value="0,0,0,12"/>
                                </Style>
                            </ListView.ItemContainerStyle>

                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="vm:VariableViewModel">
                                    <StackPanel>
                                        <Grid HorizontalAlignment="Stretch">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Padding="0,0,0,8"
                                                       VerticalAlignment="Bottom"
                                                       Text="{x:Bind Name}"/>
                                            <TextBox x:Name="ValueTextBox"
                                                     Grid.Column="1"
                                                     HorizontalAlignment="Left"
                                                     Style="{StaticResource VariableTextBoxStyle}"
                                                     GotFocus="TextBoxGotFocus"
                                                     KeyDown="TextBoxKeyDown"
                                                     LosingFocus="TextBoxLosingFocus"
                                                     Text="{x:Bind Value, Mode=OneWay}"/>
                                            <ToggleButton Grid.Column="2"
                                                          HorizontalAlignment="Right"
                                                          Background="Transparent"
                                                          FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                          Content="&#xE713;"
                                                          IsChecked="{x:Bind SliderSettingsVisible, Mode=TwoWay}">
                                                <ToggleButton.Resources>
                                                    <SolidColorBrush x:Key="ToggleButtonBackgroundPressed" Color="Transparent"/>
                                                    <SolidColorBrush x:Key="ToggleButtonBackgroundChecked" Color="Transparent"/>
                                                    <SolidColorBrush x:Key="ToggleButtonBackgroundCheckedPointerOver" Color="Transparent"/>
                                                    <SolidColorBrush x:Key="ToggleButtonBorderBrushCheckedPointerOver" Color="Transparent"/>
                                                    <SolidColorBrush x:Key="ToggleButtonBackgroundPointerOver" Color="Transparent"/>
                                                    <SolidColorBrush x:Key="ToggleButtonBorderBrushPointerOver" Color="Transparent"/>
                                                    <SolidColorBrush x:Key="ToggleButtonBackgroundCheckedPressed" Color="Transparent"/>
                                                    <SolidColorBrush x:Key="ToggleButtonForegroundPointerOver" Color="{ThemeResource SystemAccentColor}"/>
                                                    <SolidColorBrush x:Key="ToggleButtonForegroundPressed" Color="{ThemeResource SystemAccentColor}"/>
                                                    <SolidColorBrush x:Key="ToggleButtonForegroundChecked" Color="{ThemeResource SystemAccentColor}"/>
                                                    <SolidColorBrush x:Key="ToggleButtonForegroundCheckedPressed" Color="{ThemeResource SystemAccentColor}"/>
                                                    <SolidColorBrush x:Key="ToggleButtonForegroundCheckedPointerOver" Color="{ThemeResource SystemAccentColor}"/>
                                                    <x:Double x:Key="TextControlThemeMinWidth">32</x:Double>
                                                </ToggleButton.Resources>
                                            </ToggleButton>
                                        </Grid>
                                        <Slider MinHeight="38"
                                                Maximum="{x:Bind Max, Mode=TwoWay}"
                                                Minimum="{x:Bind Min, Mode=TwoWay}"
                                                StepFrequency="{x:Bind Step, Mode=TwoWay}"
                                                Visibility="{x:Bind SliderSettingsVisible, Converter={StaticResource BooleanToVisibilityNegationConverter}, Mode=OneWay}"
                                                Value="{x:Bind Value, Mode=TwoWay}"/>
                                        <Grid Grid.Row="1"
                                              MinHeight="38"
                                              HorizontalAlignment="Stretch"
                                              Visibility="{x:Bind SliderSettingsVisible, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock x:Uid="MinTextBlock"
                                                           Padding="0,0,0,8"
                                                           VerticalAlignment="Bottom"
                                                           FontWeight="SemiBold"/>
                                                <TextBox x:Name="MinTextBox"
                                                         MaxWidth="96"
                                                         Style="{StaticResource VariableTextBoxStyle}"
                                                         GotFocus="TextBoxGotFocus"
                                                         KeyDown="TextBoxKeyDown"
                                                         LosingFocus="TextBoxLosingFocus"
                                                         Text="{x:Bind Min, Mode=OneWay}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="1"
                                                        HorizontalAlignment="Center"
                                                        Orientation="Horizontal">
                                                <TextBlock x:Uid="StepTextBlock"
                                                           Padding="0,0,0,8"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Bottom"
                                                           FontWeight="SemiBold"/>
                                                <TextBox x:Name="StepTextBox"
                                                         MaxWidth="96"
                                                         HorizontalAlignment="Center"
                                                         Style="{StaticResource VariableTextBoxStyle}"
                                                         GotFocus="TextBoxGotFocus"
                                                         KeyDown="TextBoxKeyDown"
                                                         LosingFocus="TextBoxLosingFocus"
                                                         Text="{x:Bind Step, Mode=OneWay}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                                <TextBlock x:Uid="MaxTextBlock"
                                                           Padding="0,0,0,8"
                                                           VerticalAlignment="Bottom"
                                                           FontWeight="SemiBold"/>
                                                <TextBox x:Name="MaxTextBox"
                                                         MaxWidth="96"
                                                         Style="{StaticResource VariableTextBoxStyle}"
                                                         GotFocus="TextBoxGotFocus"
                                                         KeyDown="TextBoxKeyDown"
                                                         LosingFocus="TextBoxLosingFocus"
                                                         Text="{x:Bind Max, Mode=OneWay}"/>
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Flyout>
                </Button.Flyout>
            </Button>
        </Grid>

        <!-- Right portion of the screen -->
        <Grid x:Name="RightGrid"
              Grid.Row="1"
              Grid.RowSpan="2"
              Grid.Column="1"
              Margin="0,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="5*"/>
                <RowDefinition Height="3*"/>
                <RowDefinition Height="3*"/>
            </Grid.RowDefinitions>

            <StackPanel>
                <Button x:Name="Share" Click="OnShareClick">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE72D;"/>
	            </Button>
                <local:EquationInputArea Grid.Row="0" Equations="{x:Bind ViewModel.Equations}"/>
            </StackPanel>

            <Grid x:Name="ButtonContainerGrid"
                  Grid.Row="2"
                  Margin="3,0,3,3"
                  UseLayoutRounding="False">
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>

                <controls:CalculatorButton x:Name="XButton"
                                           x:Uid="xButton"
                                           Grid.Row="0"
                                           Grid.Column="0"
                                           Style="{StaticResource OperatorButtonStyle}"
                                           FontSize="16"
                                           ButtonId="X"
                                           Content="𝑥"
                                           FlowDirection="LeftToRight"/>
                <controls:CalculatorButton x:Name="YButton"
                                           x:Uid="yButton"
                                           Grid.Row="0"
                                           Grid.Column="1"
                                           Style="{StaticResource OperatorButtonStyle}"
                                           FontSize="16"
                                           ButtonId="Y"
                                           Content="𝑦"
                                           FlowDirection="LeftToRight"/>
                <controls:CalculatorButton x:Name="PowerButton"
                                           x:Uid="graphingPowerButton"
                                           Grid.Row="0"
                                           Grid.Column="2"
                                           Style="{StaticResource OperatorButtonStyle}"
                                           ButtonId="XPowerY"
                                           Content="^"/>
                <controls:CalculatorButton x:Name="squareRootButton"
                                           x:Uid="squareRootButton"
                                           Grid.Row="0"
                                           Grid.Column="3"
                                           Style="{StaticResource SymbolOperatorButtonStyle}"
                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                           ButtonId="Sqrt"
                                           Content="&#xE94B;"/>

                <!-- Display controls -->
                <controls:CalculatorButton x:Name="ClearButton"
                                           x:Uid="clearButton"
                                           Grid.Row="1"
                                           Grid.Column="2"
                                           Style="{StaticResource OperatorButtonStyle}"
                                           FontSize="16"
                                           ButtonId="Clear"
                                           Content="C"/>
                <controls:CalculatorButton x:Name="BackSpaceButton"
                                           x:Uid="backSpaceButton"
                                           Grid.Row="1"
                                           Grid.Column="3"
                                           Style="{StaticResource SymbolOperatorButtonStyle}"
                                           FontSize="16"
                                           ButtonId="Backspace"
                                           Content="&#xE94F;"/>

                <!-- Basic operators -->
                <controls:CalculatorButton x:Name="EqualButton"
                                           x:Uid="graphingEqualButton"
                                           Grid.Row="0"
                                           Grid.Column="4"
                                           Style="{StaticResource AccentCalcButtonStyle}"
                                           ButtonId="Equals"
                                           Content="&#xE94E;"/>
                <controls:CalculatorButton x:Name="DivideButton"
                                           x:Uid="divideButton"
                                           Grid.Row="1"
                                           Grid.Column="4"
                                           Style="{StaticResource AccentCalcButtonStyle}"
                                           ButtonId="Divide"
                                           Content="&#xE94A;"/>
                <controls:CalculatorButton x:Name="MultiplyButton"
                                           x:Uid="multiplyButton"
                                           Grid.Row="2"
                                           Grid.Column="4"
                                           Style="{StaticResource AccentCalcButtonStyle}"
                                           ButtonId="Multiply"
                                           Content="&#xE947;"/>
                <controls:CalculatorButton x:Name="MinusButton"
                                           x:Uid="minusButton"
                                           Grid.Row="3"
                                           Grid.Column="4"
                                           Style="{StaticResource AccentCalcButtonStyle}"
                                           ButtonId="Subtract"
                                           Content="&#xE949;"/>
                <controls:CalculatorButton x:Name="PlusButton"
                                           x:Uid="plusButton"
                                           Grid.Row="4"
                                           Grid.Column="4"
                                           Style="{StaticResource AccentCalcButtonStyle}"
                                           ButtonId="Add"
                                           Content="&#xE948;"/>


                <controls:CalculatorButton x:Name="logBase10Button"
                                           x:Uid="logBase10Button"
                                           Grid.Row="1"
                                           Grid.Column="0"
                                           Style="{StaticResource OperatorButtonStyle}"
                                           ButtonId="LogBase10"
                                           Content="log"/>
                <controls:CalculatorButton x:Name="logBaseEButton"
                                           x:Uid="logBaseEButton"
                                           Grid.Row="1"
                                           Grid.Column="1"
                                           Style="{StaticResource OperatorButtonStyle}"
                                           ButtonId="LogBaseE"
                                           Content="ln"/>
                <controls:CalculatorButton x:Name="powerOf10Button"
                                           x:Uid="powerOf10Button"
                                           Grid.Row="2"
                                           Grid.Column="0"
                                           Style="{StaticResource SymbolOperatorButtonStyle}"
                                           AutomationProperties.AutomationId="powerOf10Button"
                                           ButtonId="TenPowerX"
                                           Content="&#xF7CC;"/>
                <controls:CalculatorButton x:Name="powerOfEButton"
                                           x:Uid="powerOfEButton"
                                           Grid.Row="3"
                                           Grid.Column="0"
                                           Style="{StaticResource SymbolOperatorButtonStyle}"
                                           ButtonId="EPowerX"
                                           Content="&#xf7ce;"/>
                <controls:CalculatorButton x:Name="piButton"
                                           x:Uid="piButton"
                                           Grid.Row="4"
                                           Grid.Column="0"
                                           Style="{StaticResource SymbolOperatorButtonStyle}"
                                           FontSize="14"
                                           ButtonId="Pi"
                                           Content="&#xf7cf;"/>

                <controls:CalculatorButton x:Name="openParenthesisButton"
                                           x:Uid="openParenthesisButton"
                                           Grid.Row="5"
                                           Grid.Column="0"
                                           Style="{StaticResource ParenthesisCalcButtonStyle}"
                                           FontSize="19"
                                           ButtonId="OpenParenthesis"
                                           Content="("/>
                <controls:CalculatorButton x:Name="closeParenthesisButton"
                                           x:Uid="closeParenthesisButton"
                                           Grid.Row="5"
                                           Grid.Column="1"
                                           Style="{StaticResource OperatorButtonStyle}"
                                           FontSize="19"
                                           ButtonId="CloseParenthesis"
                                           Content=")"/>

                <!-- The Numberpad -->
                <local:NumberPad x:Name="NumberPad"
                                 x:Uid="NumberPad"
                                 Grid.Row="2"
                                 Grid.RowSpan="4"
                                 Grid.Column="1"
                                 Grid.ColumnSpan="3"
                                 ButtonStyle="{StaticResource NumericButtonStyle24}"/>

                <controls:CalculatorButton x:Name="PlotButton"
                                           x:Uid="plotButton"
                                           Grid.Row="5"
                                           Grid.Column="4"
                                           Style="{StaticResource AccentCalcButtonStyle}"
                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                           ButtonId="Plot"
                                           Content="&#xE72A;"/>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
